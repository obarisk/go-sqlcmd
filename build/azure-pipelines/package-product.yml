# sqlcmd package pipeline

trigger: 
  tags:
    include:
      - v0.*

pr: none

variables:
  VERSION: '0.0.1'
  Build.SourcesCliDirectory: '$(Build.SourcesDirectory)/'
  skip.upload: "true"

stages:
  - stage: CreatePackages
    displayName: Create Packages
    jobs:
    - job: CreatePackages
      strategy:
        matrix:
          rpm:
            imageName: 'ubuntu-latest'
            artifact: LinuxAmd64
            os:
            arch:
          debian:
            imageName: 'ubuntu-latest'
            artifact: LinuxAmd64
            os:
            arch:       
      pool:
        vmImage: $(imageName)
      steps:
        - template: package-create.yml
          parameters:
            OS: $(os)
            Arch: $(arch)
            ArtifactName: $(artifact)
  - stage: TestPackages
    displayName: Test Packages
    jobs:
    - job: TestPackages
      strategy:
        matrix:
          rpm:
            imageName: 'ubuntu-latest'
            artifact: LinuxAmd64
            os:
            arch:
          debian:
            imageName: 'ubuntu-latest'
            artifact: LinuxAmd64
            os:
            arch:       
      pool:
        vmImage: $(imageName)
      steps:
        - template: package-test.yml
          parameters:
            OS: $(os)
            Arch: $(arch)
            ArtifactName: $(artifact)